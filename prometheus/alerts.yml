groups:
  - name: geostreamdb.rules
    rules:
      - alert: TargetDown
        expr: up == 0
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Target down: {{ $labels.job }} on {{ $labels.instance }}"
          description: "Prometheus cannot scrape {{ $labels.job }} on {{ $labels.instance }} for at least 2 minutes"

      - alert: NodeHighCpuUsage
        expr: 100 * (1 - avg by (instance) (rate(node_cpu_seconds_total{job="node-exporter", mode="idle"}[5m]))) > 85
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "High node CPU usage on {{ $labels.instance }}"
          description: "Node CPU usage has been above 85% for 10 minutes"

      - alert: NodeHighMemoryUsage
        expr: 100 * (1 - (node_memory_MemAvailable_bytes{job="node-exporter"} / node_memory_MemTotal_bytes{job="node-exporter"})) > 90
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "High node memory usage on {{ $labels.instance }}"
          description: "Node memory usage has been above 90% for 10 minutes"

      - alert: GeostreamdbPodHighCpu
        expr: sum by (pod) (rate(container_cpu_usage_seconds_total{namespace="geostreamdb", container!="", container!="POD"}[5m])) > 0.8
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "High pod CPU usage: {{ $labels.pod }}"
          description: "Pod CPU usage has been above 0.8 cores for 10 minutes"

      - alert: GeostreamdbPodHighMemory
        expr: sum by (pod) (container_memory_working_set_bytes{namespace="geostreamdb", container!="", container!="POD"}) > 1073741824
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "High pod memory usage: {{ $labels.pod }}"
          description: "Pod memory working set has been above 1 GiB for 10 minutes"

      - alert: PrometheusAlertmanagerDisconnected
        expr: prometheus_notifications_alertmanagers_discovered < 1
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Prometheus cannot discover Alertmanager"
          description: "Prometheus has not discovered any Alertmanager targets for at least 5 minutes"